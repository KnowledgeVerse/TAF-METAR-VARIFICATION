<!doctype html>
<html lang="hi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IMD SYNOP Decoder - ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§Æ‡•å‡§∏‡§Æ ‡§µ‡§ø‡§≠‡§æ‡§ó</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      body {
        font-family: "Inter", "Noto Sans Devanagari", sans-serif;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        min-height: 100vh;
      }
      .glass-panel {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .station-card {
        background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
        border-left: 4px solid #3b82f6;
        transition: all 0.3s ease;
      }
      .station-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
      }
      .param-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }
      .param-item {
        background: rgba(59, 130, 246, 0.1);
        border-radius: 0.5rem;
        padding: 0.75rem;
        border: 1px solid rgba(59, 130, 246, 0.2);
      }
      .param-label {
        font-size: 0.75rem;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .param-value {
        font-size: 1.125rem;
        font-weight: 600;
        color: #f8fafc;
        margin-top: 0.25rem;
      }
      .code-badge {
        font-family: "Courier New", monospace;
        background: #0f172a;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        color: #60a5fa;
      }
      .summary-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
      }
      .summary-table th {
        background: rgba(59, 130, 246, 0.2);
        color: #60a5fa;
        padding: 0.75rem;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        position: sticky;
        top: 0;
      }
      .summary-table td {
        padding: 0.75rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        color: #e2e8f0;
      }
      .summary-table tr:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      .rh-highlight {
        background: rgba(34, 197, 94, 0.2);
        color: #4ade80;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-weight: 600;
      }
      .wb-highlight {
        background: rgba(251, 146, 60, 0.2);
        color: #fb923c;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-weight: 600;
      }
      .vis-highlight {
        background: rgba(168, 85, 247, 0.2);
        color: #c084fc;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-weight: 600;
      }
      .gmt-badge {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .date-badge {
        background: rgba(34, 197, 94, 0.2);
        color: #4ade80;
        padding: 0.25rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        border: 1px solid rgba(34, 197, 94, 0.3);
      }
      .month-badge {
        background: rgba(251, 146, 60, 0.2);
        color: #fb923c;
        padding: 0.25rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        border: 1px solid rgba(251, 146, 60, 0.3);
      }
      .cloud-cl {
        color: #60a5fa;
      }
      .cloud-cm {
        color: #c084fc;
      }
      .cloud-ch {
        color: #f472b6;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }
      .progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        transition: width 0.3s ease;
      }

      /* Date Picker Styles */
      .date-picker-popup {
        display: none;
        position: absolute;
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 0.75rem;
        padding: 1rem;
        z-index: 50;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      }
      .date-picker-popup.active {
        display: block;
      }
      .date-picker-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
      .date-picker-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 0.25rem;
        text-align: center;
      }
      .date-picker-day {
        padding: 0.5rem;
        border-radius: 0.375rem;
        cursor: pointer;
        font-size: 0.875rem;
      }
      .date-picker-day:hover {
        background: rgba(59, 130, 246, 0.3);
      }
      .date-picker-day.selected {
        background: #3b82f6;
        color: white;
      }
      .date-picker-day.other-month {
        color: #64748b;
      }
      .date-picker-weekday {
        color: #94a3b8;
        font-size: 0.75rem;
        padding: 0.25rem;
      }
      .month-year-selector {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      .month-year-selector select {
        background: #0f172a;
        border: 1px solid #334155;
        color: white;
        padding: 0.5rem;
        border-radius: 0.375rem;
      }

      /* Modal Styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 100;
        justify-content: center;
        align-items: center;
      }
      .modal-overlay.active {
        display: flex;
      }
      .modal-content {
        background: #1e293b;
        border-radius: 1rem;
        padding: 2rem;
        max-width: 90vw;
        max-height: 90vh;
        overflow: auto;
        border: 1px solid #334155;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }
      .close-btn {
        background: none;
        border: none;
        color: #94a3b8;
        font-size: 1.5rem;
        cursor: pointer;
      }
      .close-btn:hover {
        color: white;
      }
      .view-toggle {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      .view-toggle button {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        border: 1px solid #334155;
        background: #0f172a;
        color: #94a3b8;
        cursor: pointer;
      }
      .view-toggle button.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }
    </style>
  </head>
  <body class="text-slate-200 p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
      <!-- Navigation -->
      <!-- Navigation Bar -->
      <div
        class="glass-panel rounded-xl p-3 mb-8 flex flex-wrap justify-center gap-2"
      >
        <a
          href="index.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Home"
          ><i class="fas fa-home"></i
        ></a>
        <a
          href="live.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Live Preview"
          ><i class="fas fa-tower-broadcast"></i
        ></a>
        <a
          href="temp.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Live Temp"
          ><i class="fas fa-thermometer-half"></i
        ></a>
        <a
          href="wind.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Wind"
          ><i class="fas fa-wind"></i
        ></a>
        <a
          href="rain.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Rain"
          ><i class="fas fa-cloud-showers-heavy"></i
        ></a>
        <a
          href="humidity.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Humidity"
          ><i class="fas fa-tint"></i
        ></a>
        <a
          href="display.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Display Mode"
          ><i class="fas fa-tv"></i
        ></a>
        <div class="w-px h-10 bg-slate-700 mx-1"></div>
        <a
          href="bulletin.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Weather Bulletin"
          ><i class="fas fa-clipboard-list"></i
        ></a>
        <a
          href="Generate_Weather_Bulletin.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Generate Bulletin"
          ><i class="fas fa-file-lines"></i
        ></a>
        <a
          href="max_min_rh.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Observed Data"
          ><i class="fas fa-table"></i
        ></a>
        <a
          href="Weather_summary.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Weather Summary"
          ><i class="fas fa-file-alt"></i
        ></a>
        <a
          href="Detailed_Weather_Forecast.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Detailed Forecast"
          ><i class="fas fa-list-alt"></i
        ></a>
        <a
          href="Weather_Warning_Table.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Warning Table"
          ><i class="fas fa-table"></i
        ></a>
        <a
          href="bulk_import.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Import Data"
          ><i class="fas fa-file-import"></i
        ></a>
        <a
          href="Temperature_Forecast.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Min/Max Temp"
          ><i class="fas fa-temperature-high"></i
        ></a>
        <a
          href="forecast.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="7-Day Forecast"
          ><i class="fas fa-calendar-day"></i
        ></a>
        <a
          href="warning.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="7-Day Warning"
          ><i class="fas fa-exclamation-triangle"></i
        ></a>
        <a
          href="bulletin_footer.html"
          class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-all border border-slate-700 w-10 h-10 flex items-center justify-center"
          title="Bulletin Footer"
          ><i class="fas fa-file-signature"></i
        ></a>
        <a
          href="synop.html"
          class="p-2 rounded-lg bg-blue-600 text-white border border-blue-500 w-10 h-10 flex items-center justify-center"
          title="SYNOP Decoder"
          ><i class="fas fa-code"></i
        ></a>
      </div>

      <!-- Header -->
      <div class="text-center mb-8">
        <h1
          class="text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-blue-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"
        >
          IMD SYNOP Decoder
        </h1>
        <p class="text-slate-400 text-lg">
          ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§Æ‡•å‡§∏‡§Æ ‡§µ‡§ø‡§≠‡§æ‡§ó - ‡§∏‡§§‡§π ‡§Æ‡•å‡§∏‡§Æ ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§® ‡§°‡§ø‡§ï‡•ã‡§°‡§∞
        </p>
      </div>

      <!-- Input Section -->
      <div class="glass-panel rounded-2xl p-6 mb-8">
        <div class="flex flex-col md:flex-row gap-4 mb-4">
          <div class="flex-1">
            <label class="block text-sm font-medium text-slate-300 mb-2"
              >SYNOP Data Paste ‡§ï‡§∞‡•á‡§Ç (Supports 30,000+ lines)</label
            >
            <textarea
              id="synopInput"
              rows="10"
              class="w-full bg-slate-900 border border-slate-700 rounded-lg p-4 text-slate-300 font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
            ></textarea>
            <div class="progress-bar hidden" id="progressBar">
              <div
                class="progress-fill"
                id="progressFill"
                style="width: 0%"
              ></div>
            </div>
            <div
              id="processingStatus"
              class="text-sm text-slate-400 mt-2 hidden"
            ></div>
          </div>
        </div>
        <div class="flex flex-wrap gap-3">
          <button
            onclick="decodeAndStoreSynop()"
            class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-semibold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg shadow-blue-500/30"
          >
            Decode & Store ‡§ï‡§∞‡•á‡§Ç
          </button>
          <button
            onclick="clearAll()"
            class="bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-all"
          >
            Clear
          </button>
          <button
            onclick="loadExample()"
            class="bg-purple-600 hover:bg-purple-500 text-white font-semibold py-3 px-6 rounded-lg transition-all"
          >
            Example Load ‡§ï‡§∞‡•á‡§Ç
          </button>
          <button
            onclick="showDatabaseView()"
            class="bg-green-600 hover:bg-green-500 text-white font-semibold py-3 px-6 rounded-lg transition-all"
          >
            <i class="fas fa-database mr-2"></i>Database View
          </button>
          <button
            onclick="exportDatabase()"
            class="bg-amber-600 hover:bg-amber-500 text-white font-semibold py-3 px-6 rounded-lg transition-all"
          >
            <i class="fas fa-download mr-2"></i>Export JSON
          </button>
        </div>
      </div>

      <!-- Database View -->
      <div id="databaseView" class="hidden mb-8">
        <div class="glass-panel rounded-2xl p-6 mb-6">
          <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
            <i class="fas fa-database text-green-400"></i>Stored SYNOP Database
          </h2>

          <!-- Advanced Date Picker -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 relative">
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2"
                >Select Date</label
              >
              <div class="relative">
                <input
                  type="text"
                  id="selectDate"
                  readonly
                  placeholder="Click to select date"
                  class="bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-white w-full cursor-pointer"
                  onclick="toggleDatePicker()"
                />
                <i
                  class="fas fa-calendar absolute right-3 top-3 text-slate-500"
                ></i>

                <!-- Date Picker Popup -->
                <div id="datePickerPopup" class="date-picker-popup">
                  <div class="date-picker-header">
                    <button
                      onclick="changeYear(-1)"
                      class="text-slate-400 hover:text-white"
                    >
                      <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="month-year-selector">
                      <select id="monthSelect" onchange="renderCalendar()">
                        <option value="0">January</option>
                        <option value="1">February</option>
                        <option value="2">March</option>
                        <option value="3">April</option>
                        <option value="4">May</option>
                        <option value="5">June</option>
                        <option value="6">July</option>
                        <option value="7">August</option>
                        <option value="8">September</option>
                        <option value="9">October</option>
                        <option value="10">November</option>
                        <option value="11">December</option>
                      </select>
                      <select id="yearSelect" onchange="renderCalendar()">
                        <!-- Years populated by JS -->
                      </select>
                    </div>
                    <button
                      onclick="changeYear(1)"
                      class="text-slate-400 hover:text-white"
                    >
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </div>
                  <div class="date-picker-grid" id="calendarGrid">
                    <!-- Calendar populated by JS -->
                  </div>
                </div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2"
                >Select GMT</label
              >
              <select
                id="selectGMT"
                class="bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-white w-full"
              >
                <option value="all">All GMT</option>
                <option value="00">00 GMT</option>
                <option value="03">03 GMT</option>
                <option value="06">06 GMT</option>
                <option value="09">09 GMT</option>
                <option value="12">12 GMT</option>
                <option value="15">15 GMT</option>
                <option value="18">18 GMT</option>
                <option value="21">21 GMT</option>
              </select>
            </div>

            <div class="flex items-end gap-2">
              <button
                onclick="loadDateData()"
                class="bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg transition-all w-full"
              >
                Load Data
              </button>
              <button
                onclick="exportToExcel()"
                class="bg-green-600 hover:bg-green-500 text-white font-semibold py-2 px-4 rounded-lg transition-all"
                title="Export to Excel"
              >
                <i class="fas fa-file-excel"></i>
              </button>
            </div>

            <div class="flex items-end">
              <button
                onclick="show0312Table()"
                class="bg-amber-600 hover:bg-amber-500 text-white font-semibold py-2 px-4 rounded-lg transition-all w-full text-sm"
              >
                <i class="fas fa-table mr-2"></i>03 & 12 GMT Table
              </button>
            </div>
          </div>

          <!-- Available Dates -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-white mb-3">
              Available Dates:
            </h3>
            <div
              id="availableDatesList"
              class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 bg-slate-900 rounded-lg"
            ></div>
          </div>

          <!-- Date Range -->
          <div class="glass-panel rounded-xl p-4 mb-6 border border-slate-700">
            <h3 class="text-lg font-semibold text-white mb-3">
              Date Range Comparison
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-xs text-slate-400 mb-1"
                  >From Date</label
                >
                <input
                  type="text"
                  id="fromDate"
                  placeholder="DD-MM-YYYY"
                  class="bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white w-full text-sm"
                />
              </div>
              <div>
                <label class="block text-xs text-slate-400 mb-1">To Date</label>
                <input
                  type="text"
                  id="toDate"
                  placeholder="DD-MM-YYYY"
                  class="bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white w-full text-sm"
                />
              </div>
              <div class="flex items-end">
                <button
                  onclick="compareDates()"
                  class="bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-2 px-4 rounded-lg transition-all w-full text-sm"
                >
                  Compare
                </button>
              </div>
            </div>
          </div>

          <!-- Stored Data Display -->
          <div id="storedDataDisplay" class="space-y-6"></div>
        </div>
      </div>

      <!-- Detail Modal -->
      <div id="detailModal" class="modal-overlay">
        <div class="modal-content w-full max-w-4xl">
          <div class="modal-header">
            <h2 class="text-2xl font-bold text-white" id="modalTitle">
              Station Details
            </h2>
            <button class="close-btn" onclick="closeModal()">&times;</button>
          </div>
          <div class="view-toggle">
            <button class="active" onclick="showModalView('table')">
              Table View
            </button>
            <button onclick="showModalView('detailed')">Detailed View</button>
          </div>
          <div id="modalBody"></div>
        </div>
      </div>

      <!-- 03 & 12 GMT Special Table -->
      <div id="special0312Table" class="hidden mb-8">
        <div class="glass-panel rounded-2xl p-6 border-2 border-amber-500/50">
          <div class="flex justify-between items-center mb-4">
            <h2
              class="text-xl font-bold text-white flex items-center gap-2 text-amber-400"
            >
              <i class="fas fa-star"></i>03 & 12 GMT Special Summary
            </h2>
            <button
              onclick="export0312ToExcel()"
              class="bg-green-600 hover:bg-green-500 text-white font-semibold py-2 px-4 rounded-lg text-sm"
            >
              <i class="fas fa-file-excel mr-2"></i>Export Excel
            </button>
          </div>
          <div class="overflow-x-auto max-h-96 overflow-y-auto">
            <table class="summary-table" id="table0312">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>GMT</th>
                  <th>Station</th>
                  <th>Temp</th>
                  <th>Max</th>
                  <th>Min</th>
                  <th>WB</th>
                  <th>RH</th>
                  <th>Pressure</th>
                  <th>Visibility</th>
                  <th>Wind</th>
                  <th>Weather</th>
                  <th>Clouds</th>
                </tr>
              </thead>
              <tbody id="tbody0312"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Current Results -->
      <div id="currentResults">
        <div
          id="dateTimeInfo"
          class="hidden mb-6 glass-panel rounded-xl p-4 border-l-4 border-cyan-500"
        >
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div>
              <span class="text-slate-400 text-sm"
                >Observation Date & Time</span
              >
              <div class="flex items-center gap-3 mt-1 flex-wrap">
                <span class="month-badge" id="monthDisplay">--</span>
                <span class="date-badge" id="obsDateDisplay">--</span>
                <span class="gmt-badge" id="obsTimeDisplay">-- GMT</span>
              </div>
            </div>
            <div class="flex gap-6 text-sm flex-wrap">
              <div>
                <span class="text-slate-500">Report Type:</span
                ><span class="text-white font-semibold ml-2">AAXX</span>
              </div>
              <div>
                <span class="text-slate-500">Wind Unit:</span
                ><span
                  id="windUnit"
                  class="text-white font-semibold ml-2"
                ></span>
              </div>
              <div>
                <span class="text-slate-500">Stations:</span
                ><span id="totalStations" class="text-white font-semibold ml-2"
                  >0</span
                >
              </div>
            </div>
          </div>
        </div>

        <div
          id="summarySection"
          class="hidden mb-8 glass-panel rounded-xl p-6 overflow-hidden"
        >
          <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
            <span class="w-2 h-2 bg-green-400 rounded-full"></span>GMT Summary
            Table
          </h2>
          <div class="overflow-x-auto max-h-96 overflow-y-auto">
            <table class="summary-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>GMT</th>
                  <th>Station ID</th>
                  <th>Station Name</th>
                  <th>Temp</th>
                  <th>WB</th>
                  <th>RH</th>
                  <th>Pressure</th>
                  <th>Visibility</th>
                  <th>Wind</th>
                  <th>Weather</th>
                  <th>Cloud (CL/CM/CH)</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="summaryTableBody"></tbody>
            </table>
          </div>
        </div>

        <div id="resultsContainer" class="space-y-6"></div>
      </div>

      <div id="emptyState" class="text-center py-20">
        <div class="text-6xl mb-4">üå§Ô∏è</div>
        <h3 class="text-xl font-semibold text-slate-400">
          SYNOP Data ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞ ‡§π‡•à
        </h3>
        <p class="text-slate-500 mt-2">
          ‡§ä‡§™‡§∞ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡§æ ‡§°‡•á‡§ü‡§æ ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
        </p>
      </div>

      <!-- Footer -->
      <footer class="mt-16 pt-8 border-t border-slate-700/50 text-center">
        <div class="space-y-2 mb-6">
          <h3 class="text-xl font-bold text-white mb-2">
            Bihar Weather Forecast
          </h3>
          <p class="text-slate-400 text-sm">
            ‡§°‡•á‡§ü‡§æ ‡§∏‡•ç‡§∞‡•ã‡§§: India Meteorological Department (IMD), Meteorological
            Centre, Patna.
          </p>
          <p class="text-slate-400 text-sm">
            ‡§¨‡§ø‡§π‡§æ‡§∞ ‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä: ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§è‡§µ‡§Ç ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§‡•Ä‡§ï‡§∞‡§£
          </p>
        </div>

        <div class="mb-2">
          <span class="text-2xl font-extrabold text-[#ff9966]"
            >@ Lal Kamal</span
          >
        </div>
        <p class="text-slate-500 text-sm mb-4">All Rights Reserved.</p>

        <p
          class="text-slate-400 text-sm flex justify-center items-center gap-2 mb-6"
        >
          <i class="fas fa-eye"></i> Visitors:
          <span id="visitorCount" class="font-mono font-bold text-blue-400"
            >...</span
          >
        </p>

        <button
          onclick="window.scrollTo({ top: 0, behavior: 'smooth' })"
          class="bg-slate-800 hover:bg-slate-700 text-slate-300 px-4 py-2 rounded-lg text-sm transition-all mb-8"
        >
          Back to Top <i class="fas fa-arrow-up ml-1"></i>
        </button>
      </footer>
    </div>

    <script>
      // Database
      let synopDatabase =
        JSON.parse(localStorage.getItem("synopDatabase")) || {};
      let currentExcelData = []; // For Excel export

      // Cloud Type Names
      const cloudNames = {
        CL: {
          0: "No low clouds",
          1: "Cumulus humilis",
          2: "Cumulus mediocris",
          3: "Cumulonimbus (no anvil)",
          4: "Stratocumulus from Cumulus",
          5: "Stratocumulus",
          6: "Stratus",
          7: "Fractus (bad weather)",
          8: "Cumulus & Stratocumulus",
          9: "Cumulonimbus (with anvil)",
        },
        CM: {
          0: "No medium clouds",
          1: "Altostratus semitransparent",
          2: "Altostratus/Nimbostratus",
          3: "Altocumulus semitransparent",
          4: "Altocumulus patches",
          5: "Altocumulus bands",
          6: "Altocumulus from Cumulus",
          7: "Altocumulus multiple layers",
          8: "Altocumulus with towers",
          9: "Altocumulus chaotic",
        },
        CH: {
          0: "No high clouds",
          1: "Cirrus filaments",
          2: "Dense Cirrus",
          3: "Cirrus anvil remains",
          4: "Cirrus invading sky",
          5: "Cirrus bands <45¬∞",
          6: "Cirrus bands >45¬∞",
          7: "Cirrostratus covering sky",
          8: "Cirrostratus not invading",
          9: "Cirrocumulus",
        },
      };

      const monthMap = {
        JAN: "01",
        FEB: "02",
        MAR: "03",
        APR: "04",
        MAY: "05",
        JUN: "06",
        JUL: "07",
        AUG: "08",
        SEP: "09",
        OCT: "10",
        NOV: "11",
        DEC: "12",
      };
      const monthNames = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];

      let currentMonth = new Date().getMonth();
      let currentYear = new Date().getFullYear();
      let selectedDateObj = null;

      const stationNames = {
        42492: "Patna",
        42591: "Gaya",
        42498: "Bhagalpur",
        42500: "Purnea",
        42283: "Valmiki Nagar",
        42395: "Forbesganj",
        42588: "Dehri",
        42383: "Motihari",
        42393: "Supaul",
        42391: "Darbhanga",
        42488: "Chapra",
        42387: "Muzaffarpur",
        42499: "Sabour",
      };

      const codeTables = {
        windDir: {
          "00": "Calm",
          "02": "NNE",
          "05": "NE",
          "07": "ENE",
          "09": "E",
          11: "ESE",
          14: "SE",
          16: "SSE",
          18: "S",
          20: "SSW",
          23: "SW",
          25: "WSW",
          27: "W",
          29: "WNW",
          32: "NW",
          34: "NNW",
          36: "N",
          99: "Var",
        },
        cloudAmount: {
          0: "0/8",
          1: "1/8",
          2: "2/8",
          3: "3/8",
          4: "4/8",
          5: "5/8",
          6: "6/8",
          7: "7/8",
          8: "8/8",
          9: "Obsc",
        },
        presentWeather: {
          "00": "Clear",
          "01": "Clouds‚Üì",
          "02": "Same",
          "03": "Clouds‚Üë",
          "05": "Haze",
          10: "Mist",
          50: "Drizzle",
          60: "Rain",
          61: "Rain Mod",
          62: "Rain Hvy",
          70: "Snow",
          80: "Showers",
          95: "T-Storm",
        },
      };

      // Date Picker Functions
      function initDatePicker() {
        const yearSelect = document.getElementById("yearSelect");
        const currentY = new Date().getFullYear();
        for (let y = currentY - 5; y <= currentY + 1; y++) {
          const option = document.createElement("option");
          option.value = y;
          option.textContent = y;
          if (y === currentYear) option.selected = true;
          yearSelect.appendChild(option);
        }
        document.getElementById("monthSelect").value = currentMonth;
        renderCalendar();
      }

      function renderCalendar() {
        const month = parseInt(document.getElementById("monthSelect").value);
        const year = parseInt(document.getElementById("yearSelect").value);
        const grid = document.getElementById("calendarGrid");

        grid.innerHTML = "";

        // Weekday headers
        const weekdays = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
        weekdays.forEach((d) => {
          const div = document.createElement("div");
          div.className = "date-picker-weekday";
          div.textContent = d;
          grid.appendChild(div);
        });

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();

        // Previous month days
        for (let i = firstDay - 1; i >= 0; i--) {
          const div = document.createElement("div");
          div.className = "date-picker-day other-month";
          div.textContent = daysInPrevMonth - i;
          grid.appendChild(div);
        }

        // Current month days
        const today = new Date();
        for (let d = 1; d <= daysInMonth; d++) {
          const div = document.createElement("div");
          div.className = "date-picker-day";
          div.textContent = d;

          // Check if this date is in database
          const dateStr = `${String(d).padStart(2, "0")}-${String(month + 1).padStart(2, "0")}-${year}`;
          if (synopDatabase[dateStr]) {
            div.style.background = "rgba(34, 197, 94, 0.3)";
            div.style.color = "#4ade80";
            div.style.fontWeight = "bold";
          }

          if (
            selectedDateObj &&
            selectedDateObj.date === d &&
            selectedDateObj.month === month &&
            selectedDateObj.year === year
          ) {
            div.classList.add("selected");
          }

          div.onclick = () => selectDate(d, month, year);
          grid.appendChild(div);
        }
      }

      function selectDate(day, month, year) {
        selectedDateObj = { date: day, month: month, year: year };
        const dateStr = `${String(day).padStart(2, "0")}-${String(month + 1).padStart(2, "0")}-${year}`;
        document.getElementById("selectDate").value = dateStr;
        renderCalendar();
        toggleDatePicker();
      }

      function toggleDatePicker() {
        const popup = document.getElementById("datePickerPopup");
        popup.classList.toggle("active");
        if (popup.classList.contains("active")) {
          renderCalendar();
        }
      }

      function changeYear(delta) {
        const yearSelect = document.getElementById("yearSelect");
        yearSelect.value = parseInt(yearSelect.value) + delta;
        renderCalendar();
      }

      // Close date picker when clicking outside
      document.addEventListener("click", (e) => {
        const picker = document.getElementById("datePickerPopup");
        const input = document.getElementById("selectDate");
        if (!picker.contains(e.target) && e.target !== input) {
          picker.classList.remove("active");
        }
      });

      // Modal Functions
      function showDetailModal(date, gmt, stationId) {
        const data = synopDatabase[date][gmt];
        const station = data.stations.find((s) => s.id === stationId);
        if (!station) return;

        document.getElementById("modalTitle").innerHTML = `
          <span class="date-badge">${date}</span>
          <span class="gmt-badge ml-2">${gmt}:00</span>
          <span class="text-white ml-2">${station.name} (${station.id})</span>
        `;

        showModalView("table");
        document.getElementById("detailModal").classList.add("active");
      }

      function closeModal() {
        document.getElementById("detailModal").classList.remove("active");
      }

      function showModalView(view) {
        const buttons = document.querySelectorAll(".view-toggle button");
        buttons.forEach((b) => b.classList.remove("active"));
        event.target.classList.add("active");

        const date = document
          .getElementById("modalTitle")
          .querySelector(".date-badge").textContent;
        const gmt = document
          .getElementById("modalTitle")
          .querySelector(".gmt-badge")
          .textContent.replace(":00", "");
        const stationId = document
          .getElementById("modalTitle")
          .textContent.match(/\((\d{5})\)/)[1];

        const data = synopDatabase[date][gmt];
        const station = data.stations.find((s) => s.id === stationId);

        const modalBody = document.getElementById("modalBody");

        if (view === "table") {
          modalBody.innerHTML = createStationTable(station, date, gmt);
        } else {
          modalBody.innerHTML = createStationDetailed(station, date, gmt);
        }
      }

      function createStationTable(station, date, gmt) {
        return `
          <table class="summary-table">
            <tr><th>Parameter</th><th>Value</th><th>Code</th></tr>
            <tr><td>Station ID</td><td>${station.id}</td><td>-</td></tr>
            <tr><td>Station Name</td><td>${station.name}</td><td>-</td></tr>
            <tr><td>Date</td><td>${date}</td><td>-</td></tr>
            <tr><td>GMT</td><td>${gmt}:00</td><td>-</td></tr>
            <tr><td>Temperature</td><td>${station.temp || "-"} ¬∞C</td><td>1snTTT</td></tr>
            <tr><td>Max Temperature</td><td>${station.maxTemp || "-"} ¬∞C</td><td>333 1snTxTxTx</td></tr>
            <tr><td>Min Temperature</td><td>${station.minTemp || "-"} ¬∞C</td><td>333 2snTnTnTn</td></tr>
            <tr><td>Dew Point</td><td>${station.dewPoint || "-"} ¬∞C</td><td>2snTdTdTd</td></tr>
            <tr><td>Wet Bulb</td><td>${station.extras.wb || "-"} ¬∞C</td><td>Comment</td></tr>
            <tr><td>Relative Humidity</td><td>${station.extras.rh || "-"} %</td><td>Comment</td></tr>
            <tr><td>Pressure</td><td>${station.pressure || "-"}</td><td>${station.pressureCode || "4PPPP"}</td></tr>
            <tr><td>Pressure Change</td><td>${station.pressChange || "-"}</td><td>58/59P24P24P24</td></tr>
            <tr><td>Wind Direction</td><td>${station.windDir || "-"}</td><td>dd</td></tr>
            <tr><td>Wind Speed</td><td>${station.windSpeed || "-"}</td><td>ff</td></tr>
            <tr><td>Visibility</td><td>${station.finalVisibility || "-"}</td><td>VV</td></tr>
            <tr><td>Cloud Cover (N)</td><td>${station.cloudCover || "-"}</td><td>N</td></tr>
            <tr><td>Low Cloud (CL)</td><td>${cloudNames.CL[station.CL] || station.CL || "-"} (${station.CL || "-"})</td><td>CL</td></tr>
            <tr><td>Medium Cloud (CM)</td><td>${cloudNames.CM[station.CM] || station.CM || "-"} (${station.CM || "-"})</td><td>CM</td></tr>
            <tr><td>High Cloud (CH)</td><td>${cloudNames.CH[station.CH] || station.CH || "-"} (${station.CH || "-"})</td><td>CH</td></tr>
            <tr><td>Present Weather</td><td>${station.weather || "-"}</td><td>ww</td></tr>
            <tr><td>Past Weather W1</td><td>${codeTables.presentWeather[station.W1] || station.W1 || "-"}</td><td>W1</td></tr>
            <tr><td>Past Weather W2</td><td>${codeTables.presentWeather[station.W2] || station.W2 || "-"}</td><td>W2</td></tr>
          </table>
        `;
      }

      function createStationDetailed(station, date, gmt) {
        const clName = cloudNames.CL[station.CL] || "Unknown";
        const cmName = cloudNames.CM[station.CM] || "Unknown";
        const chName = cloudNames.CH[station.CH] || "Unknown";

        return `
          <div class="space-y-4">
            <div class="glass-panel rounded-lg p-4 border border-blue-500/30">
              <h3 class="text-lg font-bold text-blue-400 mb-2">Basic Information</h3>
              <p><span class="text-slate-400">Station:</span> <span class="text-white font-semibold">${station.name}</span> (${station.id})</p>
              <p><span class="text-slate-400">Date/Time:</span> <span class="date-badge">${date}</span> <span class="gmt-badge">${gmt}:00 GMT</span></p>
            </div>
            
            <div class="glass-panel rounded-lg p-4 border border-orange-500/30">
              <h3 class="text-lg font-bold text-orange-400 mb-2">Temperature & Humidity</h3>
              <div class="grid grid-cols-2 gap-4">
                <div><span class="text-slate-400">Temperature:</span> <span class="text-2xl font-bold text-orange-300">${station.temp || "-"}¬∞C</span></div>
                <div><span class="text-slate-400">Max Temp:</span> <span class="text-xl font-bold text-orange-300">${station.maxTemp || "-"}¬∞C</span></div>
                <div><span class="text-slate-400">Min Temp:</span> <span class="text-xl font-bold text-blue-300">${station.minTemp || "-"}¬∞C</span></div>
                <div><span class="text-slate-400">Dew Point:</span> <span class="text-cyan-300">${station.dewPoint || "-"}¬∞C</span></div>
                <div><span class="text-slate-400">Wet Bulb:</span> <span class="text-orange-300">${station.extras.wb || "-"}¬∞C</span></div>
                <div><span class="text-slate-400">Relative Humidity:</span> <span class="text-green-400 font-bold">${station.extras.rh || "-"}%</span></div>
              </div>
            </div>
            
            <div class="glass-panel rounded-lg p-4 border border-purple-500/30">
              <h3 class="text-lg font-bold text-purple-400 mb-2">Pressure</h3>
              <p class="text-2xl font-bold text-purple-300">${station.pressure || "-"}</p>
              <p class="text-sm text-slate-400">Code: ${station.pressureCode || "-"}</p>
              ${station.pressChange ? `<p class="text-sm text-slate-400">24h Change: ${station.pressChange} hPa</p>` : ""}
            </div>
            
            <div class="glass-panel rounded-lg p-4 border border-cyan-500/30">
              <h3 class="text-lg font-bold text-cyan-400 mb-2">Wind</h3>
              <p><span class="text-slate-400">Direction:</span> <span class="text-white font-semibold">${station.windDir || "-"}</span></p>
              <p><span class="text-slate-400">Speed:</span> <span class="text-white font-semibold">${station.windSpeed || "-"}</span></p>
            </div>
            
            <div class="glass-panel rounded-lg p-4 border border-pink-500/30">
              <h3 class="text-lg font-bold text-pink-400 mb-2">Clouds</h3>
              <div class="space-y-2">
                <div class="flex justify-between"><span class="cloud-cl font-semibold">Low Cloud (CL):</span> <span>${clName} (${station.CL || "-"})</span></div>
                <div class="flex justify-between"><span class="cloud-cm font-semibold">Medium Cloud (CM):</span> <span>${cmName} (${station.CM || "-"})</span></div>
                <div class="flex justify-between"><span class="cloud-ch font-semibold">High Cloud (CH):</span> <span>${chName} (${station.CH || "-"})</span></div>
                <div class="flex justify-between"><span class="text-slate-400">Total Cloud Cover:</span> <span>${station.cloudCover || "-"}</span></div>
              </div>
            </div>
            
            <div class="glass-panel rounded-lg p-4 border border-yellow-500/30">
              <h3 class="text-lg font-bold text-yellow-400 mb-2">Weather & Visibility</h3>
              <p><span class="text-slate-400">Present Weather:</span> <span class="text-white">${station.weather || "-"}</span></p>
              <p><span class="text-slate-400">Past Weather W1:</span> <span class="text-slate-300">${codeTables.presentWeather[station.W1] || station.W1 || "-"}</span></p>
              <p><span class="text-slate-400">Past Weather W2:</span> <span class="text-slate-300">${codeTables.presentWeather[station.W2] || station.W2 || "-"}</span></p>
              <p><span class="text-slate-400">Visibility:</span> <span class="text-purple-300 font-semibold">${station.finalVisibility || "-"}</span></p>
            </div>
            
            <div class="bg-slate-900 rounded-lg p-4">
              <h3 class="text-sm font-bold text-slate-400 mb-2">Raw SYNOP Code</h3>
              <code class="text-xs text-slate-500 break-all">${station.raw}</code>
            </div>
          </div>
        `;
      }

      // Excel Export Functions
      function exportToExcel() {
        if (currentExcelData.length === 0) {
          alert("No data to export. Please load data first.");
          return;
        }

        const ws_data = [
          [
            "Date",
            "GMT",
            "Station ID",
            "Station Name",
            "Temperature (¬∞C)",
            "Max Temp (¬∞C)",
            "Min Temp (¬∞C)",
            "Dew Point (¬∞C)",
            "Wet Bulb (¬∞C)",
            "RH (%)",
            "Pressure (hPa)",
            "Pressure Code",
            "Pressure Change",
            "Wind Direction",
            "Wind Speed",
            "Visibility",
            "Cloud Cover (N)",
            "Low Cloud (CL)",
            "Low Cloud Name",
            "Medium Cloud (CM)",
            "Medium Cloud Name",
            "High Cloud (CH)",
            "High Cloud Name",
            "Present Weather",
            "Past Weather W1",
            "Past Weather W2",
            "Raw SYNOP",
          ],
        ];

        currentExcelData.forEach((row) => {
          ws_data.push([
            row.date,
            row.gmt,
            row.stationId,
            row.stationName,
            row.temp,
            row.maxTemp,
            row.minTemp,
            row.dewPoint,
            row.wb,
            row.rh,
            row.pressure,
            row.pressureCode,
            row.pressChange,
            row.windDir,
            row.windSpeed,
            row.visibility,
            row.cloudCover,
            row.CL,
            cloudNames.CL[row.CL] || "",
            row.CM,
            cloudNames.CM[row.CM] || "",
            row.CH,
            cloudNames.CH[row.CH] || "",
            row.weather,
            row.W1,
            row.W2,
            row.raw,
          ]);
        });

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(ws_data);

        // Set column widths
        ws["!cols"] = [
          { w: 12 },
          { w: 8 },
          { w: 12 },
          { w: 15 },
          { w: 10 },
          { w: 10 },
          { w: 10 },
          { w: 10 },
          { w: 8 },
          { w: 12 },
          { w: 12 },
          { w: 12 },
          { w: 12 },
          { w: 10 },
          { w: 12 },
          { w: 10 },
          { w: 8 },
          { w: 25 },
          { w: 8 },
          { w: 25 },
          { w: 8 },
          { w: 25 },
          { w: 15 },
          { w: 15 },
          { w: 15 },
          { w: 50 },
        ];

        XLSX.utils.book_append_sheet(wb, ws, "SYNOP Data");

        const dateStr = new Date().toISOString().split("T")[0];
        XLSX.writeFile(wb, `SYNOP_Data_${dateStr}.xlsx`);
      }

      function export0312ToExcel() {
        const allDates = Object.keys(synopDatabase).sort();
        const ws_data = [
          [
            "Date",
            "GMT",
            "Station ID",
            "Station Name",
            "Temperature (¬∞C)",
            "Max Temp (¬∞C)",
            "Min Temp (¬∞C)",
            "Wet Bulb (¬∞C)",
            "RH (%)",
            "Pressure (hPa)",
            "Visibility (m)",
            "Wind Direction",
            "Wind Speed",
            "Weather",
            "Low Cloud",
            "Medium Cloud",
            "High Cloud",
          ],
        ];

        allDates.forEach((date) => {
          ["03", "12"].forEach((gmt) => {
            if (synopDatabase[date][gmt]) {
              synopDatabase[date][gmt].stations.forEach((s) => {
                ws_data.push([
                  date,
                  gmt + ":00",
                  s.id,
                  s.name,
                  s.temp,
                  s.maxTemp,
                  s.minTemp,
                  s.extras.wb,
                  s.extras.rh,
                  s.pressure,
                  s.finalVisibility,
                  s.windDir,
                  s.windSpeed,
                  s.weather,
                  cloudNames.CL[s.CL] || s.CL,
                  cloudNames.CM[s.CM] || s.CM,
                  cloudNames.CH[s.CH] || s.CH,
                ]);
              });
            }
          });
        });

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        XLSX.utils.book_append_sheet(wb, ws, "03-12 GMT Data");
        XLSX.writeFile(
          wb,
          `SYNOP_03-12_GMT_Summary_${new Date().toISOString().split("T")[0]}.xlsx`,
        );
      }

      // Parse Functions
      function parseCommentData(comment) {
        const result = {
          rh: null,
          wb: null,
          visibility: null,
          minVisibility: null,
        };
        if (!comment) return result;

        const wbMatch =
          comment.match(/(?:W\.?B\.?\s*[=:]?\s*|^)(\d+\.?\d*)\s*(?:\/|;)/i) ||
          comment.match(/W\.?B\.?\s*[=:]?\s*(\d+\.?\d*)/i);
        if (wbMatch) result.wb = parseFloat(wbMatch[1]);

        const rhPatterns = [
          /RH\s*[=:]?\s*(\d{2,3})\s*%?/i,
          /\/(\d{2,3})\s*%/,
          /^(\d{2,3})\s*%/,
          /rh\s*[=:]?\s*(\d{2,3})/i,
        ];
        for (let pattern of rhPatterns) {
          const match = comment.match(pattern);
          if (match) {
            const val = parseInt(match[1]);
            if (val >= 0 && val <= 100) {
              result.rh = val;
              break;
            }
          }
        }

        const visPatterns = [
          /VIS\s*[=:]?\s*(\d{3,5})/i,
          /Vis\.?\s*[=:]?\s*(\d{3,5})/i,
          /\/(\d{4})(?:\/|%|$)/,
          /Vis\.?\s*(\d{3,5})/i,
        ];
        for (let pattern of visPatterns) {
          const match = comment.match(pattern);
          if (match) {
            const val = parseInt(match[1]);
            if (val >= 100 && val <= 50000) {
              result.visibility = val;
              break;
            }
          }
        }

        const minMatch = comment.match(/min\s*[=:]?\s*(\d{3,5})/i);
        if (minMatch) result.minVisibility = parseInt(minMatch[1]);

        return result;
      }

      function decodePressure(pressCode) {
        if (!pressCode || pressCode.length !== 5) return null;
        const digits = pressCode.substring(1);
        const firstDigit = digits[0];
        const value = parseInt(digits);
        if (firstDigit === "0" || firstDigit === "1")
          return (1000 + value / 10).toFixed(1);
        else return (value / 10).toFixed(1);
      }

      async function decodeAndStoreSynop() {
        const input = document.getElementById("synopInput").value.trim();
        if (!input) {
          alert("‡§ï‡•É‡§™‡§Ø‡§æ SYNOP ‡§°‡•á‡§ü‡§æ ‡§°‡§æ‡§≤‡•á‡§Ç!");
          return;
        }

        const progressBar = document.getElementById("progressBar");
        const progressFill = document.getElementById("progressFill");
        const statusDiv = document.getElementById("processingStatus");

        progressBar.classList.remove("hidden");
        statusDiv.classList.remove("hidden");

        const lines = input.split("\n");
        const totalLines = lines.length;
        statusDiv.textContent = `Processing ${totalLines} lines...`;

        let processedLines = 0;
        let allBatches = [];
        let currentBatch = {
          header: null,
          stations: [],
          month: currentMonth,
          year: currentYear,
        };

        currentMonth = String(new Date().getMonth() + 1).padStart(2, "0");
        currentYear = new Date().getFullYear();

        for (let i = 0; i < lines.length; i++) {
          const line = lines[i].trim();
          processedLines++;
          if (processedLines % 100 === 0) {
            progressFill.style.width = `${(processedLines / totalLines) * 100}%`;
            statusDiv.textContent = `Processing... ${processedLines}/${totalLines} lines`;
            await new Promise((resolve) => setTimeout(resolve, 0));
          }

          if (!line) continue;

          // Check for New Year Marker (e.g., "HAPPY NEW YEAR", "NEW YEAR 2026")
          const newYearMatch = line.match(
            /(?:HAPPY\s*)?NEW\s*YEAR(?:\s*(\d{4}))?/i,
          );
          if (newYearMatch) {
            if (currentBatch.header && currentBatch.stations.length > 0)
              allBatches.push({ ...currentBatch });
            currentMonth = "01"; // Reset to January
            if (newYearMatch[1]) {
              currentYear = parseInt(newYearMatch[1]); // Set specific year if provided
            }
            currentBatch = {
              header: null,
              stations: [],
              month: currentMonth,
              year: currentYear,
            };
            continue;
          }

          // Check for Month Header with optional Year (e.g., "NOV", "NOV 2025")
          const monthMatch = line.match(
            /^(JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:\s*(\d{4}))?:?/i,
          );
          if (monthMatch) {
            if (currentBatch.header && currentBatch.stations.length > 0)
              allBatches.push({ ...currentBatch });
            currentMonth = monthMap[monthMatch[1].toUpperCase()];
            if (monthMatch[2]) {
              currentYear = parseInt(monthMatch[2]); // Update year if present
            }
            currentBatch = {
              header: null,
              stations: [],
              month: currentMonth,
              year: currentYear,
            };
            continue;
          }

          if (line.startsWith("SMIN")) {
            if (currentBatch.header && currentBatch.stations.length > 0) {
              allBatches.push({ ...currentBatch });
              currentBatch.stations = [];
            }
            currentBatch.header = {
              bulletin: line.substring(0, 6),
              region: line.substring(6, 10),
              dateTime: line.substring(10, 16),
            };
            continue;
          }

          if (line.startsWith("AAXX")) {
            const parts = line.split(" ");
            // Fix: Initialize header if SMIN is missing
            if (!currentBatch.header) {
              currentBatch.header = {
                bulletin: "MANUAL",
                region: "XXXX",
                dateTime: "000000",
              };
            }
            if (currentBatch.header) {
              currentBatch.header.reportType = parts[0];
              currentBatch.header.obsDate = parts[1]
                ? parts[1].substring(0, 2)
                : "";
              currentBatch.header.obsHour = parts[1]
                ? parts[1].substring(2, 4)
                : "";
              currentBatch.header.windIndicator = parts[1]
                ? parts[1].substring(4, 5)
                : "";
            }
            continue;
          }

          const stationMatch = line.match(/^(\d{5})\s+/);
          if (stationMatch && currentBatch.header) {
            const station = parseStationLine(line);
            if (station) {
              // Logic to infer GMT based on Max/Min temp presence if not set or default
              // 1xxxx -> Max Temp -> Usually 12 GMT
              // 2xxxx -> Min Temp -> Usually 03 GMT
              if (
                currentBatch.header.obsHour === "" ||
                currentBatch.header.obsHour === "00"
              ) {
                if (station.maxTemp && !station.minTemp) {
                  currentBatch.header.obsHour = "12";
                } else if (station.minTemp && !station.maxTemp) {
                  currentBatch.header.obsHour = "03";
                }
              }

              station.month = currentBatch.month;
              station.year = currentBatch.year;
              currentBatch.stations.push(station);
            }
          }
        }

        if (currentBatch.header && currentBatch.stations.length > 0)
          allBatches.push(currentBatch);

        let totalStored = 0;
        allBatches.forEach((batch) => {
          const dateKey = `${batch.header.obsDate}-${batch.month}-${batch.year}`;
          const gmtKey = batch.header.obsHour;
          if (!synopDatabase[dateKey]) synopDatabase[dateKey] = {};
          synopDatabase[dateKey][gmtKey] = {
            header: batch.header,
            stations: batch.stations,
            timestamp: new Date().toISOString(),
          };
          totalStored += batch.stations.length;
        });

        localStorage.setItem("synopDatabase", JSON.stringify(synopDatabase));

        if (allBatches.length > 0) {
          displayBatch(allBatches[0]);
          if (allBatches.length > 1) displayAllBatchesSummary(allBatches);
        }

        progressBar.classList.add("hidden");
        statusDiv.classList.add("hidden");
        alert(
          `Processing complete!\nBatches: ${allBatches.length}\nStations: ${totalStored}`,
        );
      }

      function parseStationLine(line) {
        try {
          const equalParts = line.split("=");
          const mainPart = equalParts[0].trim();
          const commentPart = equalParts[1]
            ? equalParts.slice(1).join("=").trim()
            : "";
          const groups = mainPart.split(/\s+/);
          if (groups.length < 2) return null;

          const station = {
            id: groups[0],
            name: stationNames[groups[0]] || `Station ${groups[0]}`,
            raw: line,
            comment: commentPart,
            extras: parseCommentData(commentPart),
          };
          let i = 1;

          if (groups[i] && groups[i].length === 5) {
            const g = groups[i];
            station.iR = g[0];
            station.ix = g[1];
            station.h = g[2];
            station.VV = g.substring(3, 5);
            i++;
          }

          if (groups[i] && groups[i].length === 5) {
            const g = groups[i];
            station.N = g[0];
            station.dd = g.substring(1, 3);
            station.ff = g.substring(3, 5);
            station.cloudCover = codeTables.cloudAmount[station.N] || station.N;
            station.windDir =
              codeTables.windDir[station.dd] || `${parseInt(station.dd) * 10}¬∞`;
            let ff = parseInt(station.ff);
            station.windSpeed = ff >= 50 ? `${ff + 100}kn` : `${ff}kn`;
            i++;
          }

          if (groups[i] && groups[i].startsWith("1")) {
            const g = groups[i];
            const sign = g[1] === "0" ? 1 : -1;
            station.temp = ((sign * parseInt(g.substring(2, 5))) / 10).toFixed(
              1,
            );
            i++;
          }

          if (groups[i] && groups[i].startsWith("2")) {
            const g = groups[i];
            const sign = g[1] === "0" ? 1 : -1;
            station.dewPoint = (
              (sign * parseInt(g.substring(2, 5))) /
              10
            ).toFixed(1);
            i++;
          }

          if (groups[i] && groups[i].startsWith("4")) {
            station.pressureCode = groups[i];
            station.pressure = decodePressure(groups[i]) + " hPa";
            i++;
          }

          if (groups[i] && groups[i].startsWith("7")) {
            const g = groups[i];
            station.ww = g.substring(1, 3);
            station.W1 = g[3];
            station.W2 = g[4];
            station.weather =
              codeTables.presentWeather[station.ww] || station.ww;
            i++;
          }

          if (groups[i] && groups[i].startsWith("8")) {
            const g = groups[i];
            station.Nh = g[1];
            station.CL = g[2];
            station.CM = g[3];
            station.CH = g[4];
            i++;
          }

          while (i < groups.length && !groups[i].startsWith("333")) i++;
          // Fix: Allow 333 or 333/ or similar
          if (groups[i] && groups[i].startsWith("333")) {
            i++;
            if (groups[i] && groups[i].startsWith("1")) {
              const g = groups[i];
              const sign = g[1] === "0" ? 1 : -1;
              station.maxTemp = (
                (sign * parseInt(g.substring(2, 5))) /
                10
              ).toFixed(1);
              i++;
            }
            if (groups[i] && groups[i].startsWith("2")) {
              const g = groups[i];
              const sign = g[1] === "0" ? 1 : -1;
              station.minTemp = (
                (sign * parseInt(g.substring(2, 5))) /
                10
              ).toFixed(1);
              i++;
            }
            if (
              groups[i] &&
              (groups[i].startsWith("58") || groups[i].startsWith("59"))
            ) {
              const g = groups[i];
              station.pressChange =
                (g.startsWith("58") ? "‚Üë" : "‚Üì") +
                (parseInt(g.substring(2, 5)) / 10).toFixed(1);
            }
          }

          if (station.extras.visibility)
            station.finalVisibility = `${station.extras.visibility}m`;
          else if (station.VV) {
            const vvCode = station.VV;
            if (vvCode >= "90") {
              const visMap = {
                90: "<50m",
                91: "50m",
                92: "200m",
                93: "500m",
                94: "1km",
                95: "2km",
                96: "4km",
                97: "10km",
                98: "20km",
                99: "‚â•50km",
              };
              station.finalVisibility =
                visMap[vvCode] || `${parseInt(vvCode)}00m`;
            } else if (vvCode <= "50")
              station.finalVisibility = `${(parseInt(vvCode) * 0.1).toFixed(1)}km`;
            else station.finalVisibility = `${parseInt(vvCode) - 50}km`;
          }

          return station;
        } catch (e) {
          console.error("Error:", e);
          return null;
        }
      }

      function displayBatch(batch) {
        const dateKey = `${batch.header.obsDate}-${batch.month}-${batch.year}`;
        const gmtKey = batch.header.obsHour;

        document.getElementById("monthDisplay").textContent =
          monthNames[parseInt(batch.month) - 1];
        document.getElementById("obsDateDisplay").textContent = dateKey;
        document.getElementById("obsTimeDisplay").textContent =
          `${gmtKey}:00 GMT`;
        document.getElementById("windUnit").textContent =
          { 0: "Est (kn)", 1: "Anemo (kn)", 3: "Est (m/s)", 4: "Anemo (m/s)" }[
            batch.header.windIndicator
          ] || "Unknown";
        document.getElementById("totalStations").textContent =
          batch.stations.length;
        document.getElementById("dateTimeInfo").classList.remove("hidden");

        const tbody = document.getElementById("summaryTableBody");
        tbody.innerHTML = "";

        batch.stations.forEach((station) => {
          const row = document.createElement("tr");
          const clName = cloudNames.CL[station.CL] || "-";
          const cmName = cloudNames.CM[station.CM] || "-";
          const chName = cloudNames.CH[station.CH] || "-";

          row.innerHTML = `
            <td class="text-slate-400">${dateKey}</td>
            <td><span class="gmt-badge">${gmtKey}:00</span></td>
            <td class="font-mono font-semibold text-blue-400">${station.id}</td>
            <td class="font-semibold text-white">${station.name}</td>
            <td>${station.temp || "-"}</td>
            <td>${station.extras.wb || "-"}</td>
            <td>${station.extras.rh ? station.extras.rh + "%" : "-"}</td>
            <td>${station.pressure || "-"}</td>
            <td>${station.finalVisibility || "-"}</td>
            <td>${station.windDir || "-"} / ${station.windSpeed || "-"}</td>
            <td>${station.weather || "-"}</td>
            <td><span class="cloud-cl">${station.CL || "-"}</span>/<span class="cloud-cm">${station.CM || "-"}</span>/<span class="cloud-ch">${station.CH || "-"}</span></td>
            <td><button onclick="showDetailModal('${dateKey}', '${gmtKey}', '${station.id}')" class="text-blue-400 hover:text-blue-300 text-sm"><i class="fas fa-eye"></i> View</button></td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById("summarySection").classList.remove("hidden");
        displayStations(batch.stations);
        document.getElementById("emptyState").classList.add("hidden");
      }

      function displayAllBatchesSummary(batches) {
        const container = document.getElementById("resultsContainer");
        const summaryDiv = document.createElement("div");
        summaryDiv.className =
          "glass-panel rounded-xl p-4 mb-6 border-2 border-blue-500/50";
        summaryDiv.innerHTML = `
          <h3 class="text-lg font-bold text-white mb-3">All Batches Summary (${batches.length} total)</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            ${batches
              .map(
                (b) => `
              <div class="bg-slate-800 rounded-lg p-3 border border-slate-700">
                <div class="flex justify-between items-center">
                  <span class="date-badge text-sm">${b.header.obsDate}-${b.month}-${b.year}</span>
                  <span class="gmt-badge text-xs">${b.header.obsHour}:00</span>
                </div>
                <p class="text-slate-400 text-sm mt-2">${b.stations.length} stations</p>
              </div>
            `,
              )
              .join("")}
          </div>
        `;
        container.insertBefore(summaryDiv, container.firstChild);
      }

      function displayStations(stations) {
        const container = document.getElementById("resultsContainer");
        const summaryDiv = container.querySelector(".glass-panel.border-2");
        container.innerHTML = "";
        if (summaryDiv) container.appendChild(summaryDiv);

        stations.forEach((station, index) => {
          const card = document.createElement("div");
          card.className = "station-card rounded-xl p-6 animate-fade-in";
          card.style.animationDelay = `${index * 0.05}s`;

          card.innerHTML = `
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 pb-4 border-b border-slate-700">
              <div>
                <h2 class="text-2xl font-bold text-white flex items-center gap-3">${station.name}<span class="code-badge text-sm">${station.id}</span></h2>
              </div>
              <div class="mt-2 md:mt-0 flex gap-2">
                ${station.extras.rh ? `<span class="rh-highlight text-sm">RH: ${station.extras.rh}%</span>` : ""}
                ${station.extras.wb ? `<span class="wb-highlight text-sm">WB: ${station.extras.wb}¬∞C</span>` : ""}
              </div>
            </div>
            <div class="param-grid">
              <div class="param-item"><div class="param-label">Temperature</div><div class="param-value text-orange-400">${station.temp ? station.temp + "¬∞C" : "N/A"}</div>${station.maxTemp ? `<div class="text-xs text-slate-400 mt-1">Max: ${station.maxTemp}¬∞C</div>` : ""}${station.minTemp ? `<div class="text-xs text-slate-400 mt-1">Min: ${station.minTemp}¬∞C</div>` : ""}</div>
              <div class="param-item"><div class="param-label">Wet Bulb</div><div class="param-value ${station.extras.wb ? "text-orange-300" : "text-slate-500"}">${station.extras.wb ? station.extras.wb + "¬∞C" : "N/A"}</div></div>
              <div class="param-item"><div class="param-label">Relative Humidity</div><div class="param-value ${station.extras.rh ? "text-green-400" : "text-slate-500"}">${station.extras.rh ? station.extras.rh + "%" : "N/A"}</div></div>
              <div class="param-item"><div class="param-label">Pressure</div><div class="param-value text-purple-400">${station.pressure || "N/A"}</div><div class="text-xs text-slate-400">${station.pressureCode || ""}</div></div>
              <div class="param-item"><div class="param-label">Wind</div><div class="param-value">${station.windDir || "N/A"} @ ${station.windSpeed || "N/A"}</div></div>
              <div class="param-item"><div class="param-label">Visibility</div><div class="param-value text-purple-300">${station.finalVisibility || "N/A"}</div></div>
              <div class="param-item"><div class="param-label">Cloud Cover</div><div class="param-value">${station.cloudCover || "N/A"}</div></div>
              <div class="param-item"><div class="param-label">Cloud Types</div><div class="text-sm mt-1"><span class="cloud-cl">CL: ${cloudNames.CL[station.CL] || station.CL || "-"}</span><br><span class="cloud-cm">CM: ${cloudNames.CM[station.CM] || station.CM || "-"}</span><br><span class="cloud-ch">CH: ${cloudNames.CH[station.CH] || station.CH || "-"}</span></div></div>
              <div class="param-item"><div class="param-label">Weather</div><div class="param-value text-sm">${station.weather || "N/A"}</div></div>
            </div>
            <div class="mt-4 pt-4 border-t border-slate-700">
              <button onclick="this.nextElementSibling.classList.toggle('hidden')" class="text-xs text-slate-500 hover:text-slate-300">Toggle Raw Data</button>
              <div class="hidden mt-2 p-3 bg-slate-900 rounded font-mono text-xs text-slate-400 overflow-x-auto">${station.raw}</div>
            </div>
          `;
          container.appendChild(card);
        });
      }

      // Database Functions
      function showDatabaseView() {
        document.getElementById("databaseView").classList.remove("hidden");
        document.getElementById("currentResults").classList.add("hidden");
        document.getElementById("emptyState").classList.add("hidden");
        updateAvailableDatesList();
      }

      function updateAvailableDatesList() {
        const container = document.getElementById("availableDatesList");
        const dates = Object.keys(synopDatabase).sort();
        if (dates.length === 0) {
          container.innerHTML =
            '<span class="text-slate-500">No data available</span>';
          return;
        }
        container.innerHTML = dates
          .map(
            (date) => `
          <button onclick="selectDateFromButton('${date}')" class="date-badge hover:bg-green-500/30 cursor-pointer transition-all text-sm">${date}</button>
        `,
          )
          .join("");
      }

      function selectDateFromButton(date) {
        document.getElementById("selectDate").value = date;
        loadDateData();
      }

      function loadDateData() {
        const selectedDate = document.getElementById("selectDate").value.trim();
        const selectedGMT = document.getElementById("selectGMT").value;
        const display = document.getElementById("storedDataDisplay");

        currentExcelData = []; // Reset Excel data

        if (!selectedDate) {
          updateAvailableDatesList();
          return;
        }

        if (!synopDatabase[selectedDate]) {
          display.innerHTML = `<p class="text-red-400 text-center py-8">No data found for ${selectedDate}</p>`;
          return;
        }

        let html = "";
        const gmts =
          selectedGMT === "all"
            ? Object.keys(synopDatabase[selectedDate]).sort()
            : [selectedGMT];

        gmts.forEach((gmt) => {
          if (!synopDatabase[selectedDate][gmt]) return;

          const data = synopDatabase[selectedDate][gmt];

          // Prepare Excel data
          data.stations.forEach((s) => {
            currentExcelData.push({
              date: selectedDate,
              gmt: gmt + ":00",
              stationId: s.id,
              stationName: s.name,
              temp: s.temp,
              maxTemp: s.maxTemp,
              dewPoint: s.dewPoint,
              wb: s.extras.wb,
              rh: s.extras.rh,
              pressure: s.pressure,
              pressureCode: s.pressureCode,
              pressChange: s.pressChange,
              windDir: s.windDir,
              windSpeed: s.windSpeed,
              visibility: s.finalVisibility,
              cloudCover: s.cloudCover,
              CL: s.CL,
              CM: s.CM,
              CH: s.CH,
              weather: s.weather,
              W1: s.W1,
              W2: s.W2,
              raw: s.raw,
            });
          });

          html += `
            <div class="glass-panel rounded-xl p-4 mb-4 border border-blue-500/30">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-white"><span class="date-badge mr-2">${selectedDate}</span><span class="gmt-badge">${gmt}:00 GMT</span></h3>
                <span class="text-slate-400 text-sm">${data.stations.length} stations</span>
              </div>
              <div class="overflow-x-auto">
                <table class="summary-table">
                  <thead>
                    <tr>
                      <th>Station</th>
                      <th>Temp</th>
                      <th>Max</th>
                  <th>Min</th>
                      <th>WB</th>
                      <th>RH</th>
                      <th>Pressure</th>
                      <th>Visibility</th>
                      <th>Wind</th>
                      <th>Clouds (CL/CM/CH)</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${data.stations
                      .map(
                        (s) => `
                      <tr>
                        <td class="font-semibold text-white">${s.name}</td>
                        <td>${s.temp || "-"}¬∞C</td>
                        <td>${s.maxTemp || "-"}¬∞C</td>
                        <td>${s.minTemp || "-"}¬∞C</td>
                        <td>${s.extras.wb || "-"}¬∞C</td>
                        <td>${s.extras.rh ? s.extras.rh + "%" : "-"}</td>
                        <td>${s.pressure || "-"}</td>
                        <td>${s.finalVisibility || "-"}</td>
                        <td>${s.windDir || "-"} ${s.windSpeed || "-"}</td>
                        <td><span class="cloud-cl">${s.CL || "-"}</span>/<span class="cloud-cm">${s.CM || "-"}</span>/<span class="cloud-ch">${s.CH || "-"}</span></td>
                        <td><button onclick="showDetailModal('${selectedDate}', '${gmt}', '${s.id}')" class="text-blue-400 hover:text-blue-300"><i class="fas fa-eye"></i></button></td>
                      </tr>
                    `,
                      )
                      .join("")}
                  </tbody>
                </table>
              </div>
            </div>
          `;
        });

        display.innerHTML =
          html ||
          '<p class="text-slate-400 text-center">No data for selected GMT</p>';
      }

      function compareDates() {
        const fromDate = document.getElementById("fromDate").value.trim();
        const toDate = document.getElementById("toDate").value.trim();
        if (!fromDate || !toDate) {
          alert("Please enter both dates in DD-MM-YYYY format!");
          return;
        }

        const display = document.getElementById("storedDataDisplay");
        const allDates = Object.keys(synopDatabase).sort();

        const filteredDates = allDates.filter((d) => {
          const [d1, m1, y1] = d.split("-").map(Number);
          const [d2, m2, y2] = fromDate.split("-").map(Number);
          const [d3, m3, y3] = toDate.split("-").map(Number);
          const dateObj = new Date(y1, m1 - 1, d1);
          const fromObj = new Date(y2, m2 - 1, d2);
          const toObj = new Date(y3, m3 - 1, d3);
          return dateObj >= fromObj && dateObj <= toObj;
        });

        if (filteredDates.length === 0) {
          display.innerHTML =
            '<p class="text-red-400 text-center">No data found in this date range</p>';
          return;
        }

        let html = `<h3 class="text-xl font-bold text-white mb-4">Comparison: ${fromDate} to ${toDate}</h3><p class="text-green-400 mb-4">Found ${filteredDates.length} dates</p>`;

        filteredDates.forEach((date) => {
          const gmts = Object.keys(synopDatabase[date]);
          const totalStations = gmts.reduce(
            (sum, g) => sum + synopDatabase[date][g].stations.length,
            0,
          );
          html += `
            <div class="glass-panel rounded-lg p-4 mb-4 border border-slate-700">
              <h4 class="date-badge inline-block mb-2">${date}</h4>
              <p class="text-slate-300 text-sm">Total records: ${totalStations} across ${gmts.length} GMTs</p>
              <div class="flex gap-2 mt-2 flex-wrap">
                ${gmts
                  .map((g) => {
                    const s = synopDatabase[date][g].stations;
                    const avgTemp =
                      s
                        .filter((x) => x.temp)
                        .reduce((a, b) => a + parseFloat(b.temp), 0) /
                        s.filter((x) => x.temp).length || 0;
                    return `<div class="bg-slate-800 rounded p-2 text-center min-w-[80px]"><span class="gmt-badge text-xs">${g}:00</span><p class="text-slate-300 text-xs mt-1">${s.length} stns</p>${avgTemp ? `<p class="text-xs text-orange-400">Avg: ${avgTemp.toFixed(1)}¬∞C</p>` : ""}</div>`;
                  })
                  .join("")}
              </div>
            </div>
          `;
        });
        display.innerHTML = html;
      }

      function show0312Table() {
        const tbody = document.getElementById("tbody0312");
        tbody.innerHTML = "";
        const allDates = Object.keys(synopDatabase).sort();
        let count = 0;

        allDates.forEach((date) => {
          ["03", "12"].forEach((gmt) => {
            if (synopDatabase[date][gmt]) {
              const data = synopDatabase[date][gmt];
              data.stations.forEach((s) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                  <td class="text-slate-400">${date}</td>
                  <td><span class="gmt-badge">${gmt}:00</span></td>
                  <td class="font-semibold text-white">${s.name}</td>
                  <td>${s.temp || "-"}¬∞C</td>
                  <td>${s.maxTemp || "-"}¬∞C</td>
                  <td>${s.minTemp || "-"}¬∞C</td>
                  <td>${s.extras.wb || "-"}¬∞C</td>
                  <td>${s.extras.rh ? s.extras.rh + "%" : "-"}</td>
                  <td class="text-purple-400 font-semibold">${s.pressure || "-"}</td>
                  <td>${s.finalVisibility || "-"}</td>
                  <td>${s.windDir || "-"} ${s.windSpeed || "-"}</td>
                  <td>${s.weather || "-"}</td>
                  <td><span class="cloud-cl">${cloudNames.CL[s.CL] || s.CL || "-"}</span> / <span class="cloud-cm">${cloudNames.CM[s.CM] || s.CM || "-"}</span> / <span class="cloud-ch">${cloudNames.CH[s.CH] || s.CH || "-"}</span></td>
                `;
                tbody.appendChild(row);
                count++;
              });
            }
          });
        });

        if (count === 0)
          tbody.innerHTML =
            '<tr><td colspan="12" class="text-center text-slate-400 py-8">No 03 or 12 GMT data found</td></tr>';
        document.getElementById("special0312Table").classList.remove("hidden");
        document
          .getElementById("special0312Table")
          .scrollIntoView({ behavior: "smooth" });
      }

      function exportDatabase() {
        const dataStr = JSON.stringify(synopDatabase, null, 2);
        const dataBlob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `synop_database_${new Date().toISOString().split("T")[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
      }

      function clearAll() {
        document.getElementById("synopInput").value = "";
        document.getElementById("resultsContainer").innerHTML = "";
        document.getElementById("summarySection").classList.add("hidden");
        document.getElementById("dateTimeInfo").classList.add("hidden");
        document.getElementById("emptyState").classList.remove("hidden");
        document.getElementById("databaseView").classList.add("hidden");
        document.getElementById("currentResults").classList.remove("hidden");
        document.getElementById("progressBar").classList.add("hidden");
        document.getElementById("processingStatus").classList.add("hidden");
      }

      function loadExample() {
        const example = `SMIN90 VEPT 191200
AAXX 19124
42492 31996 40000 10266 20130 40140 70500 84030 333 10292 58022 84360=rh=043/18.6Vis=4500m
42591 31596 43604 10250 20170 40147 70510 82540 333 10290 58020 82620 83360= WB=20.0 RH=061% VIS=5000M

AUG:
SMIN90 VEPT 201200
AAXX 20124
42492 31996 40000 10270 20135 40145 70500 84030 333 10295 58020=rh=048/19.0Vis=4000m`;
        document.getElementById("synopInput").value = example;
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        initDatePicker();
        updateAvailableDatesList();

        // Visitor Count Display
        let count = localStorage.getItem("page_views") || 1117;
        const el = document.getElementById("visitorCount");
        if (el) el.innerText = count;
      });
    </script>
  </body>
</html>
