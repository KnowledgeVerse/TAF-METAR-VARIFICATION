<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aviation Meteorology - METAR/TAF Decoder & Verification</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo-container">
          <img
            src="logo/logo.png"
            alt="Logo"
            class="logo-img"
            width="50"
            height="50"
            onclick="toggleDropdown(event)"
          />
          <div id="navDropdown" class="dropdown-menu">
            <a
              href="#"
              onclick="
                openModal('signinModal');
                return false;
              "
              >Sign In</a
            >
            <a
              href="#"
              onclick="
                openModal('aboutModal');
                return false;
              "
              >About</a
            >
            <a
              href="#"
              onclick="
                openModal('contactModal');
                return false;
              "
              >Contact Us</a
            >
          </div>
        </div>
        <button
          id="themeToggle"
          class="theme-toggle-btn"
          onclick="toggleTheme()"
          title="Toggle Light/Dark Mode"
        >
          <i class="fas fa-sun"></i>
        </button>
        <h1>‚úàÔ∏è METAR/TAF Verification Dashboard</h1>
        <p>
          Professional Aviation Meteorology Analysis | WMO-No. 488 Standards
          <br /><span style="font-size: 0.8rem; opacity: 0.7"
            >ICAO Annex 3 Compliant Verification</span
          >
        </p>
      </header>

      <!-- Example Section -->
      <div class="example-section">
        <h3>üìã File-Based Example Loading</h3>
        <div class="btn-group" style="margin-top: 0; gap: 10px">
          <button class="quick-btn" onclick="loadFileExample('default')">
            <i class="fas fa-file-alt"></i> Load Example (2 TAFs)
          </button>
          <button class="quick-btn" onclick="loadFileExample('long')">
            <i class="fas fa-file-invoice"></i> Load Long Example (Full)
          </button>
          <button class="quick-btn" onclick="loadFileExample('short')">
            <i class="fas fa-clock"></i> Load Short TAF Example
          </button>
          <label
            class="quick-btn"
            style="display: inline-block; margin-bottom: 0"
          >
            <i class="fas fa-upload"></i> Upload CSV
            <input
              type="file"
              id="csvUpload"
              accept=".csv"
              style="display: none"
              onchange="handleCSVUpload(this)"
            />
          </label>
        </div>
        <p style="font-size: 0.85rem; color: var(--sub-text); margin-top: 10px">
          Loads data from TAF.txt, Short_TAF.txt, and METAR.txt (ignoring
          headers)
        </p>
      </div>

      <div class="main-grid">
        <div class="panel panel-taf">
          <h2>TAF Input</h2>
          <div class="quick-actions">
            <button class="quick-btn" onclick="loadExample('taf')">
              Load TAF Ex
            </button>
            <button class="quick-btn" onclick="loadExample('cavok')">
              CAVOK Ex
            </button>
            <label
              class="quick-btn"
              style="display: inline-block; margin-bottom: 0; cursor: pointer"
            >
              <i class="fas fa-file-upload"></i> Upload TAF
              <input
                type="file"
                accept=".txt,.csv"
                style="display: none"
                onchange="handleFileUpload(this, 'tafInput', 'TAF')"
              />
            </label>
          </div>
          <textarea
            id="tafInput"
            placeholder="Enter TAF message here...
Example format: TAF VECC 110500Z 1106/1212 19008KT 3500 HZ SCT018 BKN100="
          ></textarea>
          <div class="btn-group">
            <button class="btn-primary" onclick="decodeTAF()">
              üîç Decode TAF
            </button>
            <button class="btn-secondary" onclick="clearTAF()">Clear</button>
          </div>
          <div id="tafAlert" class="alert"></div>
          <div id="tafOutput" class="output-panel">
            <div class="panel-header-actions">
              <h3>Decoded TAF</h3>
              <button class="quick-btn" onclick="downloadCSV('TAF')">
                <i class="fas fa-download"></i> CSV
              </button>
            </div>
            <div id="tafDecodedContent"></div>
          </div>
        </div>

        <div class="panel panel-metar">
          <h2>METAR Input</h2>
          <div class="quick-actions">
            <button class="quick-btn" onclick="loadExample('metar')">
              Load METAR Ex
            </button>
            <button class="quick-btn" onclick="loadExample('cavok')">
              CAVOK Ex
            </button>
            <label
              class="quick-btn"
              style="display: inline-block; margin-bottom: 0; cursor: pointer"
            >
              <i class="fas fa-file-upload"></i> Upload METAR
              <input
                type="file"
                accept=".txt,.csv"
                style="display: none"
                onchange="handleFileUpload(this, 'metarInput', 'METAR')"
              />
            </label>
          </div>
          <textarea
            id="metarInput"
            placeholder="Enter METAR message(s) here (one per line for multiple)...
Example format: METAR VECC 111200Z 20012KT 4000 HZ SCT020 BKN080 28/22 Q1008="
          ></textarea>
          <div class="btn-group">
            <button class="btn-primary" onclick="decodeMETAR()">
              üîç Decode METAR
            </button>
            <button class="btn-secondary" onclick="clearMETAR()">Clear</button>
          </div>
          <div id="metarAlert" class="alert"></div>
          <div id="metarOutput" class="output-panel">
            <div class="panel-header-actions">
              <h3>Decoded METAR</h3>
              <button class="quick-btn" onclick="downloadCSV('METAR')">
                <i class="fas fa-download"></i> CSV
              </button>
            </div>
            <div id="metarDecodedContent"></div>
          </div>
        </div>
      </div>

      <div class="panel verification-panel">
        <h2>Forecast Verification</h2>
        <p style="color: #a0a0a0; margin-bottom: 20px">
          Compare METAR observations against TAF forecast using IMD verification
          criteria
        </p>
        <div class="btn-group">
          <button class="btn-success" onclick="verifyForecast()">
            ‚úÖ Verify Forecast
          </button>
          <button class="btn-secondary" onclick="window.print()">
            <i class="fas fa-print"></i> Print PDF
          </button>
          <button
            class="btn-primary"
            id="downloadCSV"
            onclick="downloadCSV('ALL')"
          >
            <i class="fas fa-file-csv"></i> Download CSV Report
          </button>
          <button class="btn-secondary" onclick="clearAll()">Clear All</button>
        </div>
        <div id="verifyAlert" class="alert"></div>
        <div id="verificationOutput" class="output-panel">
          <h3>Verification Results</h3>
          <div class="verification-result" id="verificationCards"></div>
          <div id="overallStatus"></div>
        </div>
      </div>

      <!-- Professional Dashboard Section -->
      <div class="dashboard-container" id="dashboardSection">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
          "
        >
          <h2 style="margin: 0; color: var(--accent-color)">
            üìä Verification Analytics Dashboard
          </h2>
          <div class="chart-controls">
            <button
              class="quick-btn"
              onclick="toggleDashboardExpand()"
              id="expandBtn"
            >
              <i class="fas fa-expand"></i> Expand View
            </button>
            <button class="quick-btn" onclick="resetCharts()">
              <i class="fas fa-undo"></i> Reset Zoom
            </button>
          </div>
        </div>

        <!-- Top Row: Executive Summary -->
        <div class="dashboard-grid">
          <div class="kpi-card">
            <div class="kpi-title">Overall Accuracy (CSI)</div>
            <div class="kpi-value" id="kpiCSI">--</div>
            <div class="kpi-sub">Critical Success Index</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-title">Wind Speed RMSE</div>
            <div class="kpi-value" id="kpiRMSE">--</div>
            <div class="kpi-sub">Root Mean Square Error (kt)</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-title">Visibility Hit Rate</div>
            <div class="kpi-value" id="kpiVisHit">--</div>
            <div class="kpi-sub">Within Category</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-title">Weather POD</div>
            <div class="kpi-value" id="kpiPOD">--</div>
            <div class="kpi-sub">Probability of Detection</div>
          </div>
        </div>

        <!-- Middle Row: Time Series & Categories -->
        <div class="dashboard-grid">
          <!-- Wind Analysis -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-wind"></i> Wind Verification (Speed & Direction
                Error)
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="windDualChart"></canvas>
            </div>
          </div>

          <!-- Skill Radar -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-crosshairs"></i> Overall Skill Radar
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="skillRadarChart"></canvas>
            </div>
          </div>

          <!-- Wind Timeline (New) -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-history"></i> Wind Timeline
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="windTimelineChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Middle Row 2: Visibility & Weather -->
        <div class="dashboard-grid">
          <!-- Visibility Categories -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-eye"></i> Visibility Categories (ICAO)
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="visBarChart"></canvas>
            </div>
          </div>

          <!-- Visibility Timeline (New) -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-history"></i> Visibility Timeline
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="visTimelineChart"></canvas>
            </div>
          </div>

          <!-- Weather Timeline (New) -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-cloud-sun-rain"></i> Weather Timeline
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="wxTimelineChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Bottom Row: Skill Scores & Distribution -->
        <div class="dashboard-grid">
          <!-- Cloud Timeline (New) -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-history"></i> Cloud Timeline
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="cloudTimelineChart"></canvas>
            </div>
          </div>

          <!-- Cloud Analysis -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-chart-pie"></i> Ceiling Accuracy
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="cloudPieChart"></canvas>
            </div>
          </div>

          <!-- Monthly Trend (Simulated/Calculated) -->
          <div class="chart-panel medium">
            <div class="chart-header">
              <div class="chart-title">
                <i class="fas fa-chart-line"></i> Monthly CSI Trend
              </div>
            </div>
            <div class="chart-canvas-container">
              <canvas id="trendChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Legend for Timelines -->
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color match"></div>
            <span>Match (Verified)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color mismatch"></div>
            <span>Mismatch (Not Verified)</span>
          </div>
        </div>
      </div>

      <div class="info-section">
        <h2 onclick="toggleInfoSection()">
          üìö Reference Information
          <i
            id="infoToggleIcon"
            class="fas fa-chevron-down"
            style="font-size: 1rem; transition: transform 0.3s"
          ></i>
        </h2>
        <div id="infoGrid" class="info-grid">
          <div class="info-card">
            <h4>METAR Structure</h4>
            <ul>
              <li><strong>Type:</strong> METAR or SPECI</li>
              <li><strong>Location:</strong> ICAO 4-letter code</li>
              <li><strong>Time:</strong> DDHHMMZ format</li>
              <li><strong>Wind:</strong> DDDFFKT or DDDFFGFFKT</li>
              <li><strong>Visibility:</strong> Meters (4 digits)</li>
              <li><strong>Weather:</strong> Present weather code</li>
              <li><strong>Cloud:</strong> NsNsNshshshs format</li>
              <li><strong>Temp:</strong> TT/TdTd (M for minus)</li>
              <li><strong>QNH:</strong> QPHPHPHPH (hPa)</li>
            </ul>
          </div>
          <div class="info-card">
            <h4>TAF Structure</h4>
            <ul>
              <li><strong>Type:</strong> TAF/TAF AMD/TAF COR</li>
              <li><strong>Location:</strong> ICAO 4-letter code</li>
              <li><strong>Issue:</strong> DDHHMMZ</li>
              <li><strong>Valid:</strong> DDHH/DDHH period</li>
              <li><strong>FM:</strong> From (permanent change)</li>
              <li><strong>BECMG:</strong> Becoming (gradual)</li>
              <li><strong>TEMPO:</strong> Temporary fluctuations</li>
              <li><strong>PROB:</strong> Probability (30/40)</li>
              <li><strong>NSW:</strong> No significant weather</li>
            </ul>
          </div>
          <div class="info-card">
            <h4>Verification Criteria (IMD)</h4>
            <ul>
              <li><strong>Wind Dir:</strong> ¬±20¬∞ (80%)</li>
              <li><strong>Wind Spd:</strong> ¬±5 kts (80%)</li>
              <li><strong>Vis &lt;800m:</strong> ¬±200m (80%)</li>
              <li><strong>Vis 800m-10km:</strong> ¬±30% (80%)</li>
              <li><strong>Precip:</strong> Occurrence (80%)</li>
              <li><strong>Cloud &lt;450m:</strong> ¬±1 category (70%)</li>
              <li><strong>Cloud Ht:</strong> ¬±30m/&pm;30% (70%)</li>
            </ul>
          </div>
          <div class="info-card">
            <h4>Weather Phenomena Codes</h4>
            <ul>
              <li><strong>RA:</strong> Rain</li>
              <li><strong>DZ:</strong> Drizzle</li>
              <li><strong>SN:</strong> Snow</li>
              <li><strong>TS:</strong> Thunderstorm</li>
              <li><strong>FG:</strong> Fog</li>
              <li><strong>HZ:</strong> Haze</li>
              <li><strong>+/-:</strong> Heavy/Light</li>
              <li><strong>VC:</strong> Vicinity</li>
            </ul>
          </div>
        </div>
      </div>

      <footer>
        <div style="margin-bottom: 1.5rem">
          <h3 class="footer-title">
            Bihar Aviation Weather Analysis & METAR/TAF Verification
          </h3>
          <p class="footer-subtitle">(ICAO Standard Based Interpretation)</p>
          <p class="footer-subtitle">Data Source: IMD Patna</p>
        </div>

        <div>
          <span class="footer-author">¬© Lal Kamal</span>
        </div>
        <p
          style="
            color: var(--sub-text);
            font-size: 0.875rem;
            margin-bottom: 1rem;
          "
        >
          2026 | All Rights Reserved
        </p>

        <p
          style="
            color: var(--sub-text);
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
          "
        >
          <i class="fas fa-eye"></i> Visitors:
          <span
            id="visitorCount"
            style="font-family: monospace; font-weight: bold; color: #3b82f6"
            >...</span
          >
        </p>

        <button
          onclick="window.scrollTo({ top: 0, behavior: 'smooth' })"
          class="footer-btn"
        >
          Back to Top
          <i class="fas fa-arrow-up" style="margin-left: 0.25rem"></i>
        </button>
      </footer>
    </div>

    <!-- Modals -->
    <div id="signinModal" class="modal-overlay">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal('signinModal')"
          >&times;</span
        >
        <div class="modal-header">
          <h2>Sign In</h2>
        </div>
        <form
          onsubmit="
            event.preventDefault();
            closeModal('signinModal');
          "
        >
          <div class="form-group">
            <label>Email / Username</label>
            <input type="text" placeholder="Enter your email" required />
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" placeholder="Enter password" required />
          </div>
          <button type="submit" class="btn-primary" style="width: 100%">
            Sign In
          </button>
        </form>
      </div>
    </div>

    <div id="aboutModal" class="modal-overlay">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal('aboutModal')"
          >&times;</span
        >
        <div class="modal-header">
          <h2>About</h2>
        </div>
        <p style="margin-bottom: 15px; line-height: 1.6">
          <strong
            >Bihar Aviation Weather Analysis & METAR/TAF Verification
            System</strong
          >
        </p>
        <p style="margin-bottom: 15px; color: var(--sub-text)">
          This tool is designed to decode METAR and TAF reports and verify
          forecasts against observations based on ICAO and IMD standards.
        </p>
        <p style="color: var(--sub-text)">
          Developed by <strong>Lal Kamal</strong>.
        </p>
      </div>
    </div>

    <div id="contactModal" class="modal-overlay">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal('contactModal')"
          >&times;</span
        >
        <div class="modal-header">
          <h2>Contact Us</h2>
        </div>
        <div style="text-align: center">
          <p style="margin-bottom: 10px">
            <i
              class="fas fa-envelope"
              style="color: var(--accent-color); margin-right: 10px"
            ></i>
            Email: lalkamal999@gmail.com
          </p>
          <p style="margin-bottom: 20px">
            <i
              class="fas fa-phone"
              style="color: var(--accent-color); margin-right: 10px"
            ></i>
            Phone: +91-9852917265
          </p>
          <div class="btn-group" style="justify-content: center">
            <button class="btn-secondary" onclick="closeModal('contactModal')">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
